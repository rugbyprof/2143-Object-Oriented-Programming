# Stage 4 — Building Complex Structures

## Learning goals

- Represent multi-level data (objects inside objects).
- Read and write JSON files.
- Navigate and modify nested data safely.

---

## 1️⃣ Representing real-world structures

You can nest arrays and objects indefinitely to model almost anything.

```cpp
#include <iostream>
#include "json.hpp"
using json = nlohmann::json;

int main() {
    json player = {
        {"name", "Artemis"},
        {"level", 5},
        {"stats", {{"hp", 100}, {"mp", 40}}},
        {"inventory", {
            {"weapons", {"sword", "dagger"}},
            {"potions", 3}
        }},
        {"location", {{"x", 12}, {"y", 8}}}
    };

    std::cout << player.dump(4);
}
```

Output (abbreviated):

```json
{
  "inventory": {
    "potions": 3,
    "weapons": ["sword", "dagger"]
  },
  "level": 5,
  "location": { "x": 12, "y": 8 },
  "name": "Artemis",
  "stats": { "hp": 100, "mp": 40 }
}
```

This maps naturally to how you’d think about objects in OOP.

---

## 2️⃣ Accessing nested data

```cpp
int hp = player["stats"]["hp"];
std::string weapon = player["inventory"]["weapons"][0];

std::cout << "HP: " << hp << ", weapon: " << weapon << std::endl;
```

---

## 3️⃣ Modifying nested data

```cpp
player["stats"]["hp"] = 75;                 // update value
player["inventory"]["weapons"].push_back("bow"); // append to inner array
player["location"]["z"] = 2;                // add new coordinate
```

---

## 4️⃣ Checking nested keys safely

Before diving deep, verify that each level exists.

```cpp
if (player.contains("stats") &&
    player["stats"].contains("hp")) {
    std::cout << player["stats"]["hp"] << std::endl;
}
```

For deep access in uncertain data, always check first—otherwise you might create unwanted `null` entries.

---

## 5️⃣ Reading and writing JSON files

Include `<fstream>` and treat JSON like a normal text file.

```cpp
#include <fstream>

// save
std::ofstream out("player.json");
out << player.dump(4);
out.close();

// load
std::ifstream in("player.json");
json loaded;
in >> loaded;
std::cout << loaded["name"] << " reloaded.\n";
```

This pattern (open → dump → close / open → parse) works for all projects.

---

## 6️⃣ Traversing multi-level data

Use nested loops or recursion to visit data within data.

```cpp
void print_object(const json& j, int depth = 0) {
    std::string indent(depth * 2, ' ');
    if (j.is_object()) {
        for (auto& [k, v] : j.items()) {
            std::cout << indent << k << ": ";
            if (v.is_object() || v.is_array()) {
                std::cout << "\n";
                print_object(v, depth + 1);
            } else {
                std::cout << v << "\n";
            }
        }
    } else if (j.is_array()) {
        for (auto& v : j)
            print_object(v, depth + 1);
    }
}
```

Call it with `print_object(player);` to display nested structure hierarchically.

---

## 7️⃣ C++ mapping analogy

| JSON Concept | C++ Equivalent             | Example                          |
| ------------ | -------------------------- | -------------------------------- |
| Object       | `std::map<std::string, T>` | `player["stats"]["hp"]`          |
| Array        | `std::vector<T>`           | `player["inventory"][0]`         |
| Deep nesting | Structs/classes            | `player.stats.hp` → similar idea |

This helps students mentally connect JSON syntax to familiar C++ containers.

---

## 8️⃣ Mini-exercises

A) **Data modeling**  
Create a `json` object representing a university course:

- `code`, `title`, `credits`
- `instructor` (object with `name`, `email`)
- `students` (array of objects: `name`, `major`, `grade`)

Pretty-print it.

---

B) **File save/load**  
Save your course JSON to `course.json`.  
Modify one student’s grade, then reload and confirm the change persisted.

---

C) **Nested access challenge**  
Given your course JSON, print the **names of all students** and their **majors**.  
Use either:

```cpp
for (auto& s : course["students"]) { ... }
```

or recursion if you want extra credit flair.

---

|                   |                   |
| :---------------: | :---------------: |
| [⏮️ Prev](003.md) | [Next ⏭️](005.md) |
